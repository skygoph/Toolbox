@model FileUpload.Models.ViewPolicy

@{
    ViewBag.Title = "Memo Circular Upload";
}

<style>
    .btn-file {
        position: relative;
        overflow: hidden;
    }
    .btn-file input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        min-width: 100%;
        min-height: 100%;
        font-size: 100px;
        text-align: right;
        filter: alpha(opacity=0);
        opacity: 0;
        outline: none;
        background: white;
        cursor: inherit;
        display: block;
    }
    .ajax-loader {
  visibility: hidden;
  background-color: rgba(255,255,255,0.7);
  position: absolute;
  z-index: +100 !important;
  width: 100%;
  height:100%;
}

.ajax-loader img {
  position: relative;
  top:20%;
  left:30%;
}
</style>

<h3 style="margin-left:10px;">@ViewBag.Title</h3>
<form method="post" action="@Url.Content("~/Policy/Upload")" class="distance form-horizontal" enctype="multipart/form-data">
    <div class="col-sm-12">
        <div class="alert text-center" id="msg"></div>
    </div>

    <div class="col-sm-5">
        @Html.HiddenFor(mdl => mdl.poli.intTrnPolicy)
        @Html.HiddenFor(mdl => mdl.poli.FileName)        

        <div class="form-group">
            <label class="control-label col-sm-2">Date Effective</label>
            <div class="col-sm-3">                
                @*@Html.TextBoxFor(mdl => mdl.poli.DateEffective, "{0:MM/dd/yyyy}", new { @class = "form-control" })*@
                @Html.TextBoxFor(mdl => mdl.poli.DateEffective, new { @class = "form-control", Value = Model.poli.DateEffective.ToShortDateString(), @data_date_format = "mm/dd/yyyy" })
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">Date Received and Time</label>
            <div class="col-sm-3" > 
                @Html.TextBoxFor(mdl => mdl.poli.PolDateReceived, new { @class = "form-control", Value = Model.poli.PolDateReceived.ToShortDateString(), @data_date_format = "mm/dd/yyyy" })                                        
            </div>
            <div class="col-sm-4">
                @*<input id="MemoReceivedTime" type="time" style="float:left;" required class="form-control"/>*@
                @Html.TextBoxFor(mdl => mdl.poli.PolTimeReceived, new { type = "time", @class = "form-control" })             
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">Recipient</label>
            <div class="col-sm-6">                
                @Html.TextBoxFor(mdl => mdl.poli.Recipient, new { @class = "form-control"})
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">Memo No.</label>
            <div class="col-sm-3">                
                @Html.TextBoxFor(mdl => mdl.poli.DocNo, new { @class = "form-control", @readonly = "" })
            </div>            
        </div>

        @*<div class="form-group">
            <label class="control-label col-sm-2">Policy Type</label>
            <div class="col-sm-7">
                @Html.DropDownListFor(mdl => mdl.poli.PolicyType, (SelectList)@ViewBag.policytype, new { @class = "form-control", @style="width: 100%;" })
            </div>
        </div>*@

        <div class="form-group">
            <label class="control-label col-sm-2">Selected file</label>
            <div class="col-sm-10">                
                @Html.TextBoxFor(mdl => mdl.poli.OrigFileName, new { @class = "form-control", @readonly = "" })
            </div>    
           @* <span class="btn btn-success btn-file">
                Browse...<input style="margin-top:10px;" type="file" name="file" id="file" onchange="ViewFile();" />
            </span>    *@        
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">Title</label>
            <div class="col-sm-10">                
                @Html.TextBoxFor(mdl => mdl.poli.PolicyTitle, new { @class = "form-control" })
            </div>
        </div>        

        <div class="form-group">
            <label class="control-label col-sm-2">Description</label>
            <div class="col-sm-10">                
                @Html.TextAreaFor(mdl => mdl.poli.PolicyDescription, new { @class = "form-control" })
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2">Remarks</label>
            <div class="col-sm-10">                
                @Html.TextAreaFor(mdl => mdl.poli.PolicyRemarks, new { @class = "form-control" })
            </div>
        </div>

        <div class="form-group" style="margin-left:45px;">
            <label style="font-style:italic; color:red; font-size:small;" >(this will serve as auto tag for new employees)</label><br />
            <div class="col-sm-15">
            Auto Tag New Employees?<br>
            @Html.CheckBoxFor(mdl => mdl.poli.intAutoTag, new { style="width:50px; height: 50px; text-align:center; vertical-align: middle;"})
            </div>
        </div>

        <button type="button" class="btn btn-primary pull-right" onclick="OpenModalConfirmation(2);">Save Memo</button>
    </div>

    <div class="col-sm-7">
        <div>
            <label style="font-size:12px; font-style:initial;color:red;">Note: Please review first your tagging before saving to avoid failure of unnecessary tags!</label>
        </div>
        <table id="tbl" class="table table-bordered table-striped table-heading" style="font-size:14px;">
            <thead>
                <tr>
                    <th>intTrnPolicyDetail</th> 
                    <th>intGroupNameID</th>
                    <th>GroupName</th> 
                    <th>intCompany</th>
                    <th>Company</th>               
                    <th>BranchCode</th>
                    <th>Branch</th>
                    <th>intMstDepartment</th>
                    <th>Department</th>
                    <th>intMstPosition</th>
                    <th>Position</th>
                    <th>intMstEmpPersonal</th>
                    <th>Employee</th>
                    <th>intOtherGroup</th>
                    <th>Other</th>
                    <th class="col-sm-1">Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button type="button" class="btn btn-success pull-right" onclick="OpenModalConfirmation(1);">Add item</button>        
    </div>

    
        

</form>

<!-- Modal -->
<div class="modal fade" id="myModalAddItem" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Select where to send</h4>
      </div>
      <div class="modal-body">
          <form class="form-horizontal" id="myform">

              <div class="form-group">
                <label class="col-sm-3 control-label">Group Name</label>
                <div class="col-sm-8">
                    @Html.DropDownList("GroupName",null," " ,new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div>

              <div class="form-group">
                <label class="col-sm-3 control-label">Other Group</label>
                    <div class="col-sm-8">
                        @Html.DropDownList("SpecialGroup",null," " ,new { @class = "form-control", @style="width: 100%;" })
                    </div>
               </div> 

              <hr />
                <label class="col-sm-3 control-label">Filtered Group</label>
              <br /><br />
              <div class="form-group">
                <label class="col-sm-3 control-label">Company</label>
                <div class="col-sm-8">
                    @*@Html.DropDownListFor(mdl => mdl.BranchCode, (SelectList)@ViewBag.branches, new { @class = "form-control", @style="width: 100%;" })*@
                    @Html.DropDownList("CompanyGroup",null," ",new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">Branch</label>
                <div class="col-sm-8">
                    @*@Html.DropDownListFor(mdl => mdl.BranchCode, (SelectList)@ViewBag.branches, new { @class = "form-control", @style="width: 100%;" })*@
                    @Html.DropDownList("BranchGroup",null," ",new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div>

              <div class="form-group">
                <label class="col-sm-3 control-label">Department</label>
                <div class="col-sm-8">
                    @*@Html.DropDownListFor(mdl => mdl.intMstDepartment, (SelectList)@ViewBag.depts , new { @class = "form-control", @style="width: 100%;" })*@
                    @*<select id="Department" class="form-control"></select>*@
                    @Html.DropDownList("DepartmentGroup",null," ",new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div>

              <div class="form-group">
                <label class="col-sm-3 control-label">Position</label>
                <div class="col-sm-8">
                    @*@Html.DropDownListFor(mdl => mdl.intMstPosition, (SelectList)@ViewBag.pos , new { @class = "form-control", @style="width: 100%;" })*@
                    @*<select id="Position" class="form-control"></select>*@
                    @Html.DropDownList("PositionGroup",null," ",new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div>

              <div class="form-group" id="send-id">
                <label class="col-sm-3 control-label">Employee</label>
                <div class="col-sm-8">
                    @*@Html.DropDownListFor(mdl => mdl.intMstEmpPersonal, (SelectList)@ViewBag.emps, new { @class = "form-control", @style="width: 100%;" })*@
                    @*<select id="Employee" class="form-control"></select>*@
                    @Html.DropDownList("EmployeeGroup",null," ",new { @class = "form-control", @style="width: 100%;" })
                </div>
            </div> 
              
              
                           
          </form>        
      </div>
      <div class="modal-footer">        
        <button type="button" class="btn btn-success" onclick="AddItem();"  data-dismiss="modal">Add</button>
        <button type="button" class="btn btn-warning" onclick=""  data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>


 <div class="modal fade" id="myModalError" tabindex="-1" role="dialog" aria-labelledby="myModalLabels" aria-hidden="true" data-backdrop="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabels"></h4>
      </div>
      <div class="modal-body" id="myModalLabelss">
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="myModalConfirmBox" tabindex="-1" role="dialog" aria-labelledby="myModalConfirmationLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalConfimationLabel1"></h4>
        </div>
        <div class="modal-body" id="myModalConfimationLabel2">
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-success btn-lg" onclick="SaveRecord();">&nbsp;&nbsp;Yes&nbsp;&nbsp;</button>  
         <button type="button" class="btn btn-danger btn-lg" data-dismiss="modal">&nbsp;&nbsp;No&nbsp;&nbsp;</button>
        </div>
    </div>
    </div>
</div>

<div class="ajax-loader">
  <img src="~/Images/ajax-loader.gif" class="img-responsive" />
</div>



@section scripts
{

    <script type="text/javascript">        

        function OpenModalConfirmation(type) {
            if (type == 1) {
                $('#myModalAddItem').modal();
                document.getElementById("myform").reset();
                GetDisplay();
            }
           if (type == 2) {
                    $('#myModalConfimationLabel1').html("Confirmation");
                    $('#myModalConfimationLabel2').html("Are you sure you want to save?");
                    $('#myModalConfirmBox').modal();

                }
            }
        


            $(document).ready(function () {
                //COMPANY GROUP BOX
                $("#CompanyGroup").change(function () {

                    var branchID = document.getElementById("BranchGroup").value;
                    var employeeID = document.getElementById("EmployeeGroup").value;
                    var positionID = document.getElementById("PositionGroup").value;
                    var DepartmentID = document.getElementById("DepartmentGroup").value;
                    var companyID = $(this).val();

                    if ((companyID == "") || (companyID == "0") || (companyID == 0)) {


                        //LOAD COMPANY
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadCompany", "Memo")',
                            data: { "CompanyID": "" },
                            success: function (json, textStatus) {
                                $("#CompanyGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#CompanyGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Company!");
                            }
                        });


                        //LOAD BRANCH
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadBranch", "Memo")',
                            data: { "CompanyID": "", "BranchID": "" },
                            success: function (json, textStatus) {
                                $("#BranchGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Branch!");
                            }
                        });


                        //LOAD DEPARTMENT
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadDepartment", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {
                                $("#DepartmentGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                                //$("#ddlDesig").prop("disabled", false);  
                            },
                            error: function () {
                                alert("Data Not Found for Department");
                            }
                        });



                        //LOAD POSITION
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadPosition", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {
                                $("#PositionGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Position");
                            }
                        });

                        //LOAD EMPLOYEE
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadEmployee", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "", "PositionID": "" },
                            success: function (json, textStatus) {
                                $("#EmployeeGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found for Employee");
                            }
                        });

                    }
                    else {
                        $("#BranchGroup").empty();
                        $("#DepartmentGroup").empty();
                        $("#PositionGroup").empty();
                        $("#EmployeeGroup").empty();

                        var branchID = document.getElementById("BranchGroup").value;
                        var employeeID = document.getElementById("EmployeeGroup").value;
                        var positionID = document.getElementById("PositionGroup").value;
                        var DepartmentID = document.getElementById("DepartmentGroup").value;
                        var companyID = $(this).val();

                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadBranch", "Memo")',
                            data: { "CompanyID": companyID, "BranchID": branchID },
                            success: function (json, textStatus) {



                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });
                    }

                }); //END COMPANY GROUP BOX


                //BRANCH GROUP BOX
                $("#BranchGroup").change(function () {

                    var companyID = document.getElementById("CompanyGroup").value;
                    var employeeID = document.getElementById("EmployeeGroup").value;
                    var positionID = document.getElementById("PositionGroup").value;
                    var DepartmentID = document.getElementById("DepartmentGroup").value;
                    var branchID = $(this).val();




                    if ((branchID == "") || (branchID == "0") || (branchID == 0)) {

                        $("#CompanyGroup").empty();
                        $("#DepartmentGroup").empty();
                        $("#PositionGroup").empty();
                        $("#EmployeeGroup").empty();

                        //LOAD COMPANY
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadCompany", "Memo")',
                            data: { "CompanyID": "" },
                            success: function (json, textStatus) {
                                $("#CompanyGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#CompanyGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Company!");
                            }
                        });


                        //LOAD BRANCH
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadBranch", "Memo")',
                            data: { "CompanyID": "", "BranchID": "" },
                            success: function (json, textStatus) {
                                $("#BranchGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Branch!");
                            }
                        });


                        //LOAD DEPARTMENT
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadDepartment", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {
                                $("#DepartmentGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                                //$("#ddlDesig").prop("disabled", false);  
                            },
                            error: function () {
                                alert("Data Not Found for Department");
                            }
                        });



                        //LOAD POSITION
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadPosition", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {

                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Position");
                            }
                        });

                        //LOAD EMPLOYEE
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadEmployee", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "", "PositionID": "" },
                            success: function (json, textStatus) {

                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found for Employee");
                            }
                        });




                    }
                    else {



                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadDepartment", "Memo")',
                            data: { "CompanyID": companyID, "BranchID": branchID, "DepartmentID": DepartmentID },
                            success: function (json, textStatus) {
                                $("#DepartmentGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                                //$("#ddlDesig").prop("disabled", false);  
                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });

                    }

                }); //END BRANCH GROUP BOX


                //DEPARTMENT GROUP BOX
                $("#DepartmentGroup").change(function () {
                    var companyID = document.getElementById("CompanyGroup").value;
                    var branchID = document.getElementById("BranchGroup").value;
                    var employeeID = document.getElementById("EmployeeGroup").value;
                    var positionID = document.getElementById("PositionGroup").value;
                    var DepartmentID = $(this).val();



                    if ((DepartmentID == "") || (DepartmentID == "0") || (DepartmentID == 0)) {
                        $("#CompanyGroup").empty();
                        $("#BranchGroup").empty();
                        $("#PositionGroup").empty();
                        $("#EmployeeGroup").empty();


                        //LOAD COMPANY
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadCompany", "Memo")',
                            data: { "CompanyID": "" },
                            success: function (json, textStatus) {
                                $("#CompanyGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#CompanyGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Company!");
                            }
                        });



                        //LOAD BRANCH
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadBranch", "Memo")',
                            data: { "CompanyID": "", "BranchID": "" },
                            success: function (json, textStatus) {
                                $("#BranchGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for branch!");
                            }
                        });

                        //LOAD DEPARTMENT
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadDepartment", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {
                                $("#DepartmentGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                                //$("#ddlDesig").prop("disabled", false);  
                            },
                            error: function () {
                                alert("Data Not Found for Department");
                            }
                        });


                        //LOAD POSITION
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadPosition", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {

                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Position");
                            }
                        });

                        //LOAD EMPLOYEE
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadEmployee", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "", "PositionID": "" },
                            success: function (json, textStatus) {

                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found for Employee");
                            }
                        });





                    }
                    else {

                        var companyID = document.getElementById("CompanyGroup").value;
                        var branchID = document.getElementById("BranchGroup").value;
                        var employeeID = document.getElementById("EmployeeGroup").value;
                        var positionID = document.getElementById("PositionGroup").value;
                        var DepartmentID = $(this).val();

                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadPosition", "Memo")',
                            data: { "CompanyID": companyID, "BranchID": branchID, "DepartmentID": DepartmentID },
                            success: function (json, textStatus) {
                                $("#PositionGroup").empty();
                                $("#EmployeeGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });
                    }


                }); // END OF DEPARTMENT GROUP BOX


                //EMPLOYEE GROUP BOX
                $("#PositionGroup").change(function () {
                    var companyID = document.getElementById("CompanyGroup").value;
                    var branchID = document.getElementById("BranchGroup").value;
                    var DepartmentID = document.getElementById("DepartmentGroup").value;
                    var EmployeeID = document.getElementById("EmployeeGroup").value;
                    var PositionID = $(this).val();




                    if ((PositionID == "") || (PositionID == 0) || (PositionID == "0")) {

                        $("#CompanyGroup").empty();
                        $("#BranchGroup").empty();
                        $("#DepartmentGroup").empty();


                        //LOAD COMPANY
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadCompany", "Memo")',
                            data: { "CompanyID": "" },
                            success: function (json, textStatus) {
                                $("#CompanyGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#CompanyGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Company!");
                            }
                        });


                        //LOAD BRANCH
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadBranch", "Memo")',
                            data: { "CompanyID": "", "BranchID": "" },
                            success: function (json, textStatus) {
                                $("#BranchGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for branch!");
                            }
                        });

                        //LOAD DEPARTMENT
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadDepartment", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {
                                $("#DepartmentGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });

                        //LOAD POSITION
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadPosition", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                            success: function (json, textStatus) {

                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }
                            },
                            error: function () {
                                alert("Data Not Found for Position");
                            }
                        });


                        //LOAD EMPLOYEE
                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadEmployee", "Memo")',
                            data: { "CompanyID": "", "BranchID": "", "DepartmentID": "", "PositionID": "" },
                            success: function (json, textStatus) {
                                $("#EmployeeGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });

                    }
                    else {

                        var companyID = document.getElementById("CompanyGroup").value;
                        var branchID = document.getElementById("BranchGroup").value;
                        var DepartmentID = document.getElementById("DepartmentGroup").value;
                        var EmployeeID = document.getElementById("EmployeeGroup").value;
                        var PositionID = $(this).val();



                        $.ajax({
                            cache: false,
                            type: "GET",
                            url: '@Url.Action("LoadEmployee", "Memo")',
                            data: { "CompanyID": companyID, "BranchID": branchID, "DepartmentID": DepartmentID, "PositionID": PositionID },
                            success: function (json, textStatus) {
                                $("#EmployeeGroup").empty();
                                json = json || {};
                                for (var i = 0; i < json.length; i++) {
                                    $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                                }

                            },
                            error: function () {
                                alert("Data Not Found");
                            }
                        });


                    }
                });  //END EMPLOYEE GROUP BOX


            });




            $(function () {
                var table;
                var gpdate = $("#poli_DateEffective").datepicker();
                $('#BranchCode, #intMstDepartment, #intMstPosition, #intMstEmpPersonal').select2();

                table = $("#tbl").dataTable({
                    "columnDefs": [{
                        "targets": [0, 1, 3, 5, 7, 9, 11, 13],
                        "visible": false,
                        "searchable": false
                    }],
                    "bPaginate": false,
                    "bLengthChange": false,
                    "bFilter": false,
                    "bSort": false,
                    "bInfo": false,
                    "oTableTools": {
                        "sRowSelect": "single",
                        "sSelectedClass": "selected"
                    }
                });

                $('#msg').removeClass('active');
                $('#msg').addClass('hide');


            });


            function GetDisplay() {

                //LOAD COMPANY
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: '@Url.Action("LoadCompany", "Memo")',
                    data: { "CompanyID": "" },
                    success: function (json, textStatus) {
                        $("#CompanyGroup").empty();
                        json = json || {};
                        for (var i = 0; i < json.length; i++) {
                            $("#CompanyGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                        }
                    },
                    error: function () {
                        alert("Data Not Found for Company!");
                    }
                });


                //LOAD BRANCH
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: '@Url.Action("LoadBranch", "Memo")',
                    data: { "CompanyID": "", "BranchID": "" },
                    success: function (json, textStatus) {
                        $("#BranchGroup").empty();
                        json = json || {};
                        for (var i = 0; i < json.length; i++) {
                            $("#BranchGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                        }
                    },
                    error: function () {
                        alert("Data Not Found for branch!");
                    }
                });

                //LOAD DEPARTMENT
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: '@Url.Action("LoadDepartment", "Memo")',
                    data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                    success: function (json, textStatus) {
                        $("#DepartmentGroup").empty();
                        json = json || {};
                        for (var i = 0; i < json.length; i++) {
                            $("#DepartmentGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                        }

                    },
                    error: function () {
                        alert("Data Not Found");
                    }
                });

                //LOAD POSITION
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: '@Url.Action("LoadPosition", "Memo")',
                    data: { "CompanyID": "", "BranchID": "", "DepartmentID": "" },
                    success: function (json, textStatus) {

                        json = json || {};
                        for (var i = 0; i < json.length; i++) {
                            $("#PositionGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                        }
                    },
                    error: function () {
                        alert("Data Not Found for Position");
                    }
                });


                //LOAD EMPLOYEE
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: '@Url.Action("LoadEmployee", "Memo")',
                    data: { "CompanyID": "", "BranchID": "", "DepartmentID": "", "PositionID": "" },
                    success: function (json, textStatus) {
                        $("#EmployeeGroup").empty();
                        json = json || {};
                        for (var i = 0; i < json.length; i++) {
                            $("#EmployeeGroup").append('<option value="' + json[i].Value + '">' + json[i].Text + '</option>');
                        }

                    },
                    error: function () {
                        alert("Data Not Found");
                    }
                });
            }



            function ViewFile() {
                var inp = document.getElementById('file').value;

                $('#poli_OrigFileName').val(inp);
            }

            function AddItem() {

                var GroupID = $('#GroupName').val();
                var companyID = document.getElementById("CompanyGroup").value;
                var branchID = document.getElementById("BranchGroup").value;
                var DepartmentID = document.getElementById("DepartmentGroup").value;
                var PositionID = document.getElementById("PositionGroup").value;
                var EmployeeID = document.getElementById("EmployeeGroup").value;
                var SpecialGroup = $('#SpecialGroup').val();

                if ((GroupID !== "") && (SpecialGroup !== "")) {

                    $('#myModalLabels').html("Error:");
                    $('#myModalLabelss').html("Please select only 1 for Group Name, Other Group and Filtered Group");
                    $('#myModalError').modal();

                    return false;
                }
                //if (((companyID != "0") || (branchID != "") || (DepartmentID != "0") || (PositionID != "0") || (EmployeeID != "")) && ((GroupID !== "") || (SpecialGroup !== ""))) {
                //    $('#myModalLabels').html("Error:");
                //    $('#myModalLabelss').html("Please select only 1 for Group Name, Other Group and Filtered Group");
                //    $('#myModalError').modal();

                //    return false;
                //}

                var items = {
                    "intTrnPolicyDetail": "", "intGroupNameID": "", "GroupName": "", "intCompany": "", "Company": "", "BranchCode": "", "BranchName": "", "intMstDepartment": "", "DepartmentName": "",
                    "intMstPosition": "", "PositionName": "", "intMstEmpPersonal": "", "EmpName": "", "intOtherGroup": "", "OtherGroup": ""
                };

                items.intTrnPolicyDetail = 0;
                items.intGroupNameID = $('#GroupName').val();
                items.GroupName = $('#GroupName :selected').text();
                items.intCompany = $('#CompanyGroup').val();
                items.Company = $('#CompanyGroup :selected').text();
                items.BranchCode = $('#BranchGroup').val();
                items.BranchName = $('#BranchGroup :selected').text();
                items.intMstDepartment = $('#DepartmentGroup').val();
                items.DepartmentName = $('#DepartmentGroup :selected').text();
                items.intMstPosition = $('#PositionGroup').val();
                items.PositionName = $('#PositionGroup :selected').text();
                items.intMstEmpPersonal = $('#EmployeeGroup').val();
                items.EmpName = $('#EmployeeGroup :selected').text();
                items.intOtherGroup = $('#SpecialGroup').val();
                items.OtherGroup = $('#SpecialGroup :selected').text();

                $("#tbl").dataTable()
                    .fnAddData([
                        items.intTrnPolicyDetail,
                        items.intGroupNameID,
                        items.GroupName,
                        items.intCompany,
                        items.Company,
                        items.BranchCode,
                        items.BranchName,
                        items.intMstDepartment,
                        items.DepartmentName,
                        items.intMstPosition,
                        items.PositionName,
                        items.intMstEmpPersonal,
                        items.EmpName,
                        items.intOtherGroup,
                        items.OtherGroup,
                        '<a href="javascript:void(0);" onclick="RemoveItem(this);" >Remove</a>'
                    ]);

                document.getElementById("myform").reset();

                $("#CompanyGroup").empty();
                $("#BranchGroup").empty();
                $("#DepartmentGroup").empty();
                $("#PositionGroup").empty();
                $("#EmployeeGroup").empty();

                GetDisplay();
            }

            function RemoveItem(val) {
                var nRow = $(val).parents('tr')[0];

                table.fnDeleteRow(nRow);

            }

            function RedirectMe() {
                window.location.href = '@Url.Action("Upload")';
            }

            function SaveRecord() {
                var policy = {
                    "intTrnPolicy": "", "DocNo": "", "Recipient": "", "DateEffective": "", "PolDateReceived": "", "PolTimeReceived": "", "PolicyTitle": "", "PolicyType": "",
                    "PolicyDescription": "", "PolicyRemarks": "", "intAutoTag": "", "FileName": "", "OrigFileName": "", "PolicyDet": []
                };

                var det = {
                    "intTrnPolicyDetail": "", "intTrnPolicy": "", "intGroupNameID": "", "intCompany": "", "BranchCode": "",
                    "intMstDepartment": "", "intMstPosition": "", "intMstEmpPersonal": "", "intOtherGroup": ""
                };

                policy.intTrnPolicy = $("#poli_intTrnPolicy").val();
                policy.DocNo = $("#poli_DocNo").val();
                policy.Recipient = $("#poli_Recipient").val();
                policy.DateEffective = $("#poli_DateEffective").val();
                policy.PolDateReceived = $("#poli_PolDateReceived").val();
                policy.PolTimeReceived = $("#poli_PolTimeReceived").val();
                policy.PolicyTitle = $("#poli_PolicyTitle").val();
                policy.PolicyType = $("#poli_PolicyType").val();
                policy.PolicyDescription = $("#poli_PolicyDescription").val();
                policy.FileName = $("#poli_FileName").val();
                policy.OrigFileName = $("#poli_OrigFileName").val();
                policy.PolicyRemarks = $("#poli_PolicyRemarks").val();
                policy.intAutoTag = $("#poli_intAutoTag").prop("checked") ? true : false;

                var oTable = $("#tbl").dataTable().fnGetData();

                for (var i = 0; i < oTable.length; i++) {
                    det.intTrnPolicyDetail = oTable[0];
                    det.intTrnPolicy = policy.intTrnPolicy;
                    det.intGroupNameID = oTable[i][1];
                    det.intCompany = oTable[i][3];
                    det.BranchCode = oTable[i][5];
                    det.intMstDepartment = oTable[i][7];
                    det.intMstPosition = oTable[i][9];
                    det.intMstEmpPersonal = oTable[i][11];
                    det.intOtherGroup = oTable[i][13];

                    policy.PolicyDet.push(det);

                    det = {
                        "intTrnPolicyDetail": "", "intTrnPolicy": "", "intGroupNameID": "", "intCompany": "", "BranchCode": "",
                        "intMstDepartment": "", "intMstPosition": "", "intMstEmpPersonal": "", "intOtherGroup": ""
                    };
                }

                $('#myModalConfirmBox').modal('hide');

                $.ajax({
                    url: '@Url.Action("SendTo")',
                    beforeSend: function () {
                        $('.ajax-loader').css("visibility", "visible");
                    },
                    data: JSON.stringify(policy),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (result) {

                        $('#msg').addClass('active');
                        $('#msg').removeClass('hide');

                        if (result.success == "True") {
                            $('#msg').removeClass('bg-danger');
                            $('#msg').addClass('bg-success');
                            setTimeout('RedirectMe()', 2000);
                        }
                        else {
                            $('#msg').removeClass('bg-success');
                            $('#msg').addClass('bg-danger');
                        }

                        $('.ajax-loader').css("visibility", "hidden");
                        $('#msg').html(result.msg);
                    }
                });

            }      
    </script>    
    
}